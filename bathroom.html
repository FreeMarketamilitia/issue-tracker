<!-- bathroom.html (included by sidebar.html) -->
<style>
  #scanner-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
  }
  #qr-reader { width: 100%; max-width: 500px; }
  #qr-reader-results { font-size: 14px; color: var(--muted); }
</style>

<div id="mainBathroom" class="main" aria-live="polite" aria-busy="false">
  <div class="panel" style="padding:20px;">
    <div class="panel-title" style="margin-bottom:12px;">Bathroom Break Scanner</div>
    <div id="scanner-container">
      <div id="qr-reader"></div>
      <div id="qr-reader-results" class="muted"></div>
    </div>
  </div>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
  function onScanSuccess(decodedText, decodedResult) {
    console.log(`Scan result: ${decodedText}`, decodedResult);
    document.getElementById('qr-reader-results').innerText = `Last scan: ${decodedText}`;
    google.script.run
      .withSuccessHandler(updateUI)
      .withFailureHandler(showError)
      .processBarcode(decodedText);
  }

  function updateUI(message) {
    alert(message);
    if (typeof renderBathroomAnalytics === 'function') {
      renderBathroomAnalytics();
    }
  }

  function showError(error) {
    alert(error.message);
  }

  const html5QrcodeScanner = new Html5QrcodeScanner('qr-reader', { fps: 10, qrbox: 250 });
  html5QrcodeScanner.render(onScanSuccess);
</script>

